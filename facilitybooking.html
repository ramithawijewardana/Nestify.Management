<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nestify.Management - Facility Bookings</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Booking Details Modal Styles */
        .booking-details-content {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Main Booking Modal Styles */
        .modal-content {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .booking-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .booking-detail-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .booking-detail-card h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .booking-detail-card h3 i {
            font-size: 20px;
        }
        
        .detail-item {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 500;
            opacity: 0.9;
        }
        
        .detail-value {
            font-weight: 600;
            text-align: right;
        }
        
        .booking-status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-confirmed {
            background: #10b981;
            color: white;
        }
        
        .status-pending {
            background: #f59e0b;
            color: white;
        }
        
        .status-cancelled {
            background: #ef4444;
            color: white;
        }
        
        .booking-actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn-action {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #e5e7eb;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }
        
        @media (max-width: 768px) {
            .booking-details-grid {
                grid-template-columns: 1fr;
            }
            
            .booking-details-content {
                width: 95%;
                margin: 20px auto;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-home"></i>
                <span>Nestify.Management</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="facilitybooking.html" class="nav-link active">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Facility Bookings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="billing.html" class="nav-link">
                        <i class="fas fa-credit-card"></i>
                        <span>Billing</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="requests.html" class="nav-link">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Requests</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="communityvotes.html" class="nav-link">
                        <i class="fas fa-vote-yea"></i>
                        <span>Community Votes</span>
                    </a>
                </li>
            </ul>
            <button id="logout-btn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
            <div class="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="welcome-section">
                <h1>Facility Bookings</h1>
                <p>Manage and view all facility bookings across the apartment complex</p>
            </div>
            
            <!-- Facility Grid -->
            <div class="facility-grid" id="facility-grid">
                <!-- Facilities will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Booking Modal -->
    <div id="booking-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Facility Bookings</h2>
                <span class="close" id="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                                 <div class="booking-filters">
                     <div class="filter-group">
                         <label for="date-filter">Date:</label>
                        <input type="date" id="date-filter" value="2025-08-14">
                     </div>
                 </div>
                
                <div id="bookings-content">
                    <!-- Bookings will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Details Modal -->
    <div id="booking-details-modal" class="modal">
        <div class="modal-content booking-details-content">
            <div class="modal-header">
                <h2 id="details-modal-title">Booking Details</h2>
                <span class="close" id="close-details-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="booking-details-content">
                    <!-- Booking details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="script.js"></script>
    <script>
        // Immediate debugging - check if buttons exist
        console.log('=== IMMEDIATE DEBUG ===');
        console.log('Debug button exists:', !!document.getElementById('debug-state-btn'));
        console.log('Create test button exists:', !!document.getElementById('create-test-booking-btn'));
        console.log('Logout button exists:', !!document.getElementById('logout-btn'));
        console.log('=== END IMMEDIATE DEBUG ===');
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC3Zbnm-_ghWQiFiDZcQCE4MkR_4WeDAr8",
            authDomain: "nestify-af7a6.firebaseapp.com",
            projectId: "nestify-af7a6",
            storageBucket: "nestify-af7a6.appspot.com",
            messagingSenderId: "462014928709",
            appId: "1:462014928709:web:91a79060ea330c5bba902c",
            measurementId: "G-4K8X9LM211"
        };
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        
        // Set default apartment collection for testing if not already set
        if (!localStorage.getItem('apartmentCollection')) {
            localStorage.setItem('apartmentCollection', 'apartment_1');
        }
        
        // Fix apartment collection if it's wrong (remove _bookings suffix)
        let apartmentCollection = localStorage.getItem('apartmentCollection');
        if (apartmentCollection && apartmentCollection.includes('_bookings')) {
            const correctCollection = apartmentCollection.replace('_bookings', '');
            localStorage.setItem('apartmentCollection', correctCollection);
            console.log('Fixed apartment collection from', apartmentCollection, 'to', correctCollection);
        }
        
        // Simple authentication check
        if (!localStorage.getItem('apartmentCollection')) {
                window.location.href = "login.html";
        }

        // Facility data - matching mobile app capacities
        const facilities = [
            {
                id: 'function-hall',
                name: 'Function Hall',
                icon: 'fas fa-glass-cheers',
                description: 'Large hall for events and celebrations',
                capacity: '150 people',
                timeRestriction: null
            },
            {
                id: 'ballroom',
                name: 'Ballroom',
                icon: 'fas fa-dancing',
                description: 'Elegant ballroom for formal events',
                capacity: '100 people',
                timeRestriction: null
            },
            {
                id: 'gym',
                name: 'Gym',
                icon: 'fas fa-dumbbell',
                description: 'Fully equipped fitness center',
                capacity: '30 people',
                timeRestriction: null
            },
            {
                id: 'tennis-court',
                name: 'Tennis Court',
                icon: 'fas fa-table-tennis',
                description: 'Professional tennis court',
                capacity: '4 people',
                timeRestriction: null
            },
            {
                id: 'rooftop',
                name: 'Rooftop',
                icon: 'fas fa-building',
                description: 'Rooftop area for functions',
                capacity: '80 people',
                timeRestriction: 'After 6 PM only'
            },
            {
                id: 'kids-play-area',
                name: 'Kids Play Area',
                icon: 'fas fa-child',
                description: 'Safe play area for children',
                capacity: '25 children',
                timeRestriction: null
            },
            {
                id: 'swimming-pool',
                name: 'Swimming Pool',
                icon: 'fas fa-swimming-pool',
                description: 'Olympic size swimming pool',
                capacity: '60 people',
                timeRestriction: null
            },
            {
                id: 'garden-area',
                name: 'Garden Area',
                icon: 'fas fa-seedling',
                description: 'Beautiful garden for outdoor activities',
                capacity: '50 people',
                timeRestriction: null
            },
            {
                id: 'meeting-room',
                name: 'Meeting Room',
                icon: 'fas fa-users',
                description: 'Conference room for meetings',
                capacity: '15 people',
                timeRestriction: null
            }
        ];

        let currentFacility = null;

        // Load facilities
        function loadFacilities() {
            const facilityGrid = document.getElementById('facility-grid');
            facilityGrid.innerHTML = '';

            facilities.forEach(facility => {
                const facilityCard = document.createElement('div');
                facilityCard.className = 'facility-card';
                facilityCard.onclick = () => openBookingModal(facility);
                
                facilityCard.innerHTML = `
                    <div class="facility-header">
                        <div class="facility-icon">
                            <i class="${facility.icon}"></i>
                        </div>
                        <div class="facility-info">
                            <h3>${facility.name}</h3>
                            <p>${facility.description}</p>
                        </div>
                    </div>
                    <div class="facility-status">
                        <div class="status-indicator">
                            <span class="status-dot status-available"></span>
                            <span>Available</span>
                        </div>
                        <div>
                            <small>Capacity: ${facility.capacity}</small>
                            ${facility.timeRestriction ? `<br><small>${facility.timeRestriction}</small>` : ''}
                        </div>
                    </div>
                `;
                
                facilityGrid.appendChild(facilityCard);
            });
        }

        // Open booking modal
        function openBookingModal(facility) {
            currentFacility = facility;
            const modal = document.getElementById('booking-modal');
            const modalTitle = document.getElementById('modal-title');
            
            modalTitle.textContent = `${facility.name} - Bookings`;
            modal.style.display = 'block';
            
            loadBookings(facility.name);
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('booking-modal');
            modal.style.display = 'none';
            currentFacility = null;
        }
        
        // Load bookings for a facility
        async function loadBookings(facilityName) {
            const bookingsContent = document.getElementById('bookings-content');
            const dateFilter = document.getElementById('date-filter');
            const selectedDate = dateFilter.value;
            
            showLoading(bookingsContent, 'Loading bookings...');

            try {
                const base = getFacilityBookingsBase();
                console.log("=== DEBUGGING FACILITY BOOKINGS ===");
                console.log("Facility Name:", facilityName);
                console.log("Selected Date:", selectedDate);
                console.log("Apartment Collection:", localStorage.getItem('apartmentCollection'));
                console.log("Base Collection Path:", base.path);
                
                // First, let's get ALL bookings to see what's in the collection
                console.log("Getting ALL bookings first...");
                const allBookings = await base.get();
                console.log("Total documents in collection:", allBookings.size);
                
                allBookings.forEach(doc => {
                    const data = doc.data();
                    console.log("Document ID:", doc.id);
                    console.log("Document Data:", data);
                    console.log("Facility Name in DB:", data.facilityName);
                    console.log("Date in DB:", data.date);
                    console.log("---");
                });
                
                let snap;
                try {
                    // Query by facility name and date
                    console.log("Querying with facilityName:", facilityName, "and date:", selectedDate);
                    snap = await base
                        .where('facilityName', '==', facilityName)
                        .where('date', '==', selectedDate)
                        .orderBy('startTime')
                        .get();
                    console.log("Query with facilityName - Results:", snap.size);
                    
                    // If no results, try with facilityId
                    if (snap.size === 0) {
                        console.log("No results with facilityName, trying facilityId...");
                        const facilityIdMap = {
                            'Function Hall': 'function-hall',
                            'Ballroom': 'ballroom', 
                            'Gym': 'gym',
                            'Tennis Court': 'tennis-court',
                            'Rooftop': 'rooftop',
                            'Kids Play Area': 'kids-play-area',
                            'Swimming Pool': 'pool',
                            'Garden Area': 'garden-area',
                            'Meeting Room': 'meeting-room'
                        };
                        
                        const facilityId = facilityIdMap[facilityName];
                        if (facilityId) {
                            console.log("Trying with facilityId:", facilityId);
                            snap = await base
                                .where('facilityId', '==', facilityId)
                                .where('date', '==', selectedDate)
                                .orderBy('startTime')
                                .get();
                            console.log("Query with facilityId - Results:", snap.size);
                        }
                    }
                } catch (e) {
                    console.warn("Index error, falling back to no ordering:", e);
                    snap = await base
                        .where('facilityName', '==', facilityName)
                        .where('date', '==', selectedDate)
                        .get();
                    console.log("Query without ordering - Results:", snap.size);
                    
                    // If still no results, try facilityId without ordering
                    if (snap.size === 0) {
                        const facilityIdMap = {
                            'Function Hall': 'function-hall',
                            'Ballroom': 'ballroom', 
                            'Gym': 'gym',
                            'Tennis Court': 'tennis-court',
                            'Rooftop': 'rooftop',
                            'Kids Play Area': 'kids-play-area',
                            'Swimming Pool': 'pool',
                            'Garden Area': 'garden-area',
                            'Meeting Room': 'meeting-room'
                        };
                        
                        const facilityId = facilityIdMap[facilityName];
                        if (facilityId) {
                            console.log("Trying with facilityId (no ordering):", facilityId);
                            snap = await base
                                .where('facilityId', '==', facilityId)
                                .where('date', '==', selectedDate)
                                .get();
                            console.log("Query with facilityId (no ordering) - Results:", snap.size);
                        }
                    }
                }

                console.log("Final query results:", snap.size);
                snap.forEach(doc => console.log("Found booking:", doc.data()));

                displayBookings(snap, selectedDate);
                
                         } catch (error) {
                 console.error("Error loading bookings:", error);
                showError(bookingsContent, "Error loading bookings. Please try again.");
            }
        }
        
        // Helper function to get facility bookings base collection
        function getFacilityBookingsBase() {
            const apartmentCollection = localStorage.getItem('apartmentCollection');
            if (!apartmentCollection) {
                throw new Error('Apartment collection not set in localStorage');
            }
            // Correct Firestore path: <apartmentCollection>/1HgCK9tLiQnkOURHXBtM/facility_bookings/entries/entries/[bookingId]
            return db
                .collection(apartmentCollection)
                .doc('1HgCK9tLiQnkOURHXBtM')
                .collection('facility_bookings')
                .doc('entries')
                .collection('entries');
        }

        // Display bookings in table
        function displayBookings(snap, date) {
            const bookingsContent = document.getElementById('bookings-content');
            
            if (snap.empty) {
                showNoData(bookingsContent, `No bookings found for ${date || 'this date'}`);
                return;
            }

            const tableHTML = `
                <table class="booking-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Room Number</th>
                            <th>Date</th>
                            <th>Time Period</th>
                            <th>Number of People</th>
                            <th>Purpose</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${snap.docs.map(doc => {
                            const booking = doc.data();
                            console.log("Processing booking:", booking);
                            
                            // Calculate end time
                            const endTime = calculateEndTime(booking.startTime, booking.duration);
                            
                            return `
                                <tr class="booking-row">
                                    <td>${booking.residentName || 'N/A'}</td>
                                    <td>${booking.roomNo || 'N/A'}</td>
                                    <td>${formatDate(booking.date)}</td>
                                    <td>${formatTime(booking.startTime)} - ${formatTime(endTime)}</td>
                                    <td>${booking.numberOfAttendees || 'N/A'}</td>
                                    <td>${booking.notes || 'General use'}</td>
                                    <td><span class="booking-status status-confirmed">Confirmed</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-primary" onclick="viewBookingDetails('${doc.id}')">View</button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            bookingsContent.innerHTML = tableHTML;
        }
        
        // Helper function to calculate end time
        function calculateEndTime(startTime, durationMinutes) {
            if (!startTime || !durationMinutes) return startTime;
            
            const [hours, minutes] = startTime.split(':').map(Number);
            const startDate = new Date();
            startDate.setHours(hours, minutes, 0, 0);
            
            const endDate = new Date(startDate.getTime() + durationMinutes * 60000);
            const endHours = endDate.getHours().toString().padStart(2, '0');
            const endMinutes = endDate.getMinutes().toString().padStart(2, '0');
            
            return `${endHours}:${endMinutes}`;
        }

        // Helper functions for booking actions
        function viewBookingDetails(bookingId) {
            console.log('Viewing booking details for ID:', bookingId);
            
            // Get the booking data from the current facility's bookings
            const base = getFacilityBookingsBase();
            base.doc(bookingId).get().then(doc => {
                if (doc.exists) {
                    const booking = doc.data();
                    showBookingDetailsModal(booking, bookingId);
                } else {
                    console.error('Booking not found:', bookingId);
                    alert('Booking not found!');
                }
            }).catch(error => {
                console.error('Error fetching booking details:', error);
                alert('Error loading booking details!');
            });
        }
        
        // Show booking details modal
        function showBookingDetailsModal(booking, bookingId) {
            const modal = document.getElementById('booking-details-modal');
            const modalTitle = document.getElementById('details-modal-title');
            const detailsContent = document.getElementById('booking-details-content');
            
            modalTitle.textContent = `Booking Details - ${booking.facilityName}`;
            
            // Calculate end time
            const endTime = calculateEndTime(booking.startTime, booking.duration);
            
            const detailsHTML = `
                <div class="booking-details-grid">
                    <div class="booking-detail-card">
                        <h3><i class="fas fa-user"></i> Resident Information</h3>
                        <div class="detail-item">
                            <span class="detail-label">Name:</span>
                            <span class="detail-value">${booking.residentName || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Room Number:</span>
                            <span class="detail-value">${booking.roomNo || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">User ID:</span>
                            <span class="detail-value">${booking.userId || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Booking ID:</span>
                            <span class="detail-value">${bookingId}</span>
                        </div>
                    </div>
                    
                    <div class="booking-detail-card">
                        <h3><i class="fas fa-calendar-alt"></i> Booking Information</h3>
                        <div class="detail-item">
                            <span class="detail-label">Facility:</span>
                            <span class="detail-value">${booking.facilityName || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Date:</span>
                            <span class="detail-value">${formatDate(booking.date)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Time Period:</span>
                            <span class="detail-value">${formatTime(booking.startTime)} - ${formatTime(endTime)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Duration:</span>
                            <span class="detail-value">${booking.duration || 0} minutes</span>
                        </div>
                    </div>
                    
                    <div class="booking-detail-card">
                        <h3><i class="fas fa-users"></i> Event Details</h3>
                        <div class="detail-item">
                            <span class="detail-label">Number of People:</span>
                            <span class="detail-value">${booking.numberOfAttendees || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Max Capacity:</span>
                            <span class="detail-value">${booking.maxCapacity || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Purpose:</span>
                            <span class="detail-value">${booking.notes || 'General use'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value">
                                <span class="booking-status-badge status-${booking.status?.toLowerCase() || 'confirmed'}">
                                    ${booking.status || 'CONFIRMED'}
                                </span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="booking-detail-card">
                        <h3><i class="fas fa-info-circle"></i> Additional Information</h3>
                        <div class="detail-item">
                            <span class="detail-label">Created At:</span>
                            <span class="detail-value">${formatDateTime(booking.createdAt)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Expires At:</span>
                            <span class="detail-value">${formatDateTime(booking.expiresAt)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Apartment ID:</span>
                            <span class="detail-value">${booking.apartmentId || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Facility ID:</span>
                            <span class="detail-value">${booking.facilityId || 'N/A'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="booking-actions">
                    <button class="btn-action btn-secondary" onclick="closeDetailsModal()">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                    <button class="btn-action btn-danger" onclick="cancelBooking('${bookingId}')">
                        <i class="fas fa-ban"></i>
                        Cancel Booking
                    </button>
                </div>
            `;
            
            detailsContent.innerHTML = detailsHTML;
            modal.style.display = 'block';
        }
        
        // Close details modal
        function closeDetailsModal() {
            const modal = document.getElementById('booking-details-modal');
            modal.style.display = 'none';
        }
        
        // Cancel booking (delete function)
        function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel and delete this booking? This action cannot be undone.')) {
                console.log('Cancelling booking:', bookingId);
                
                const apartmentCollection = localStorage.getItem('apartmentCollection') || 'apartment_1';
                const base = db.collection(apartmentCollection).doc('1HgCK9tLiQnkOURHXBtM').collection('facility_bookings').doc('entries').collection('entries');
                
                base.doc(bookingId).delete()
                    .then(() => {
                        console.log('Booking deleted successfully!');
                        alert('Booking has been cancelled and deleted successfully!');
                        
                        // Close the details modal
                        closeDetailsModal();
                        
                        // Refresh the bookings list if a facility is currently selected
                        if (currentFacility) {
                            loadBookings(currentFacility.name);
                        }
                    })
                    .catch(error => {
                        console.error('Error deleting booking:', error);
                        alert('Error deleting booking: ' + error.message);
                    });
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded fired - setting up event listeners');
            
            // Load facilities first
            loadFacilities();
            
            // Set up all event listeners with error handling
            try {
            // Close modal
                const closeModalBtn = document.getElementById('close-modal');
                if (closeModalBtn) {
                    closeModalBtn.onclick = closeModal;
                    console.log('Close modal button listener set');
                } else {
                    console.error('Close modal button not found!');
                }
                
                // Close details modal
                const closeDetailsModalBtn = document.getElementById('close-details-modal');
                if (closeDetailsModalBtn) {
                    closeDetailsModalBtn.onclick = closeDetailsModal;
                    console.log('Close details modal button listener set');
                } else {
                    console.error('Close details modal button not found!');
                }
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('booking-modal');
                if (event.target === modal) {
                    closeModal();
                }
            }
            
                         // Date filter change
                const dateFilter = document.getElementById('date-filter');
                if (dateFilter) {
                    dateFilter.addEventListener('change', function(e) {
                 if (currentFacility) {
                            loadBookings(currentFacility.name);
                        }
                    });
                    console.log('Date filter listener set');
                } else {
                    console.error('Date filter not found!');
                }

                // Logout button
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.onclick = function() {
                        console.log('Logout button clicked!');
                        localStorage.clear();
                        window.location.href = "login.html";
                    };
                    console.log('Logout button listener set');
                } else {
                    console.error('Logout button not found!');
                }
                
                
                
                console.log('All event listeners set up successfully!');
            } catch (error) {
                console.error('Error setting up event listeners:', error);
            }
        });
    </script>
</body>
</html> 
